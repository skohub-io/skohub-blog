{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023-11-22-shacl-shape/","result":{"data":{"site":{"siteMetadata":{"title":"Skohub Blog"}},"markdownRemark":{"id":"e19fa987-ceb2-54a5-b888-63169daac7e7","excerpt":"To improve the error messages thrown by SkoHub Vocabs for invalid RDF Turtle files, we decided to implement a validation step, before the static site of a…","html":"<p>To improve the error messages thrown by SkoHub Vocabs for invalid RDF Turtle files, we decided to implement a validation step, before the static site of a vocabulary gets built with the <a href=\"https://www.gatsbyjs.com/\">Gatsby framework</a>.\nThis validation step should provide more meaningful error messages than the currently cryptic ones thrown by Gatsby.\nWhile we could have gone with one of the existing SKOS validator tools like <a href=\"https://skos-play.sparna.fr/play/\">SKOS Play!</a>, <a href=\"http://www.w3.org/2001/sw/wiki/Skosify\">SKOSify</a> or <a href=\"https://www.poolparty.biz/skos-and-skos-xl\">Poolparty</a> (it’s pretty epensive) we decided to go with a more generic approach and define the shape rules not in code, but in data.</p>\n<figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/3180b8faaa30763f57cf0aeda0f8a2e3/6f3f2/shacl-logo.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEkElEQVQ4y4WTe0xTVxzHj7VFAps2KzH849AlLsojpLhmGHRlE7BlxvWy4hybPDbGY/FFRIE4gxmBQQCNcYIVWlsaBBNrLeJE0Dk3RSbbYDAfwMDHhosxE8gYpaX3fJdzWnS6Lfsl3+Sc373nc3+/7+9cEhISQsrLy0lTUxMxm83EYrE8JbPZQtrsDWTjDgMhy6tVufu+7s07eIUuTTl2z+8Ng/6tzbXkcsdJsm37dsJDLpeHxcXF7dPr9eU6na5CEISnpBOEio0bkirCo7WlH1dd+O3ug0kse7/JE5BQh4D4OvfKxA/2v7cx6bNXo1dWEkIWksjIyA3d3d1wuVwYGxvD+PgE18SEV4/GxuF2TuJi9zCKDF2ISD8+47fGgAVao4fE1ODA8Wtg0XisCYSQcBIVFaUbGBhgORelmAGeSGTy5Vqv3psJSbaK89YYMF9TTxdojSArP6e2S8P8uaPlNAMuJ0qlUrhx4wYDigAoi0mnm7L1rFo779CgdUdpYEIdZdU9t7aektU1SNx1hjqnve86HA4GDGUVCteve4Fnu+7S/EOdKDR0Ya+pG9ZzA9DvOYewtGaYz97Cw/EpWNpuYd6aI4jd6oB7xsOOcWBLS4sXGBYRKdwdGULv8IS4u66LftN3Hy/qrZCoD4O8cgCa/FY4XTP4e8Ruc6CisYevp5yup4Gh4V7g4dOD4kFbH11f9AWHPa+pR7DOgl8fTvKD024P3MxVAFmVX2Hf8R+9eZf7mQrDI4Xbw4Ownh8Rl2ywUrK6Fi+sM2G+1siuBS7+MMoPejwinC4PX6eXfYlPzd/9e4Ws5ZGfB3H7gVNcuP4oJatqQF6rBQP7xx1BsM6Mxo7Bx+3+MeXGS+80Ym1+qy/zjIdsKD/5hnKl/z4Vdrdh1WY7ik3dGPxlDGeu3uE+qrc6UGy6hp01nahu7uVDYe8+mpj655Rv3nxybfAfsaf+GqSvG9A/8jt2130LEnMIJPog8g9d5kD7KR+Q3cP+/n4OdDqn6bTLDbfbDee0ixnOPAKoB5N/TmPz/kvQ7mzlQ5MnGiFR10KV2cyBtpMnvUCVSiWMjo7+b4UsCo198I83sT8Fcm09SGw9ttd+z4Ed5y94gUFBQUJKSgq2bNkibtq0iaalpSEzMxM5OTnIyspCdnY2PsrKRk7Wh4gXMkCiikFW1cIvwQKi/ARvvp1GC3btoNrERC+QECIQQthGVKlUVKlUQqFQsD0CAwMhkUggk8mwdOnLPBexIgY5exuwTJ2OiKholqM+QSqVhpKAgAAOzMjIEIeGhqggCCgtLUVZWRksFgs0Gg0KCgrQ19eHxYuX4JTdhsz0FKS+q4e1wcyBfn5+dO7cud4KpVIpB4aFhYlGo5E2NDRwoN1uR3t7O1JTU2Gz2dDT04OqqioYTSZeqTJqBU6csHHgnDlzqK/LUCKTyThQrVaL1dXVtLKyEnl5eWyPpKQkFBcXo6ioCLm5uSgsLERJSQmsViuSk5P5R0tKSqhcLudAmUz2xEOJRCIuWrRo9kvcN9aGv78/ZnO+thAcHPzYY4VCQSUSyeMK/wIeEsftKQa/pAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"SHACL logo\" title=\"SHACL logo\" src=\"/static/3180b8faaa30763f57cf0aeda0f8a2e3/6f3f2/shacl-logo.png\" srcset=\"/static/3180b8faaa30763f57cf0aeda0f8a2e3/c26ae/shacl-logo.png 158w,\n/static/3180b8faaa30763f57cf0aeda0f8a2e3/6f3f2/shacl-logo.png 256w\" sizes=\"(max-width: 256px) 100vw, 256px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">SHACL logo</figcaption>\n  </figure>\n<p>If you want to validate the shape of an RDF graph, you currently have two options to do that. You can either use <a href=\"https://shex.io/shex-primer/index.html\">Shape Expressions (ShEx)</a> or the <a href=\"https://www.w3.org/TR/shacl/\">Shapes Constraint Language (SHACL)</a>.\nWe decided to go with SHACL for the following reasons:</p>\n<ul>\n<li>slightly better tooling (e.g. the zazuko Team provides a JS Validation library <a href=\"https://github.com/zazuko/rdf-validate-shacl\">rdf-validte-shacl</a>)</li>\n<li>there were some existing SKOS-XL SHACL definitions published by the Publications Office of the European Union: <a href=\"https://op.europa.eu/en/web/eu-vocabularies/application-profiles\">https://op.europa.eu/en/web/eu-vocabularies/application-profiles</a></li>\n</ul>\n<p>Unfortunately the SKOS-XL shape did not work with our tooling (<a href=\"https://jena.apache.org/documentation/shacl/\">Apache Jena SHACL</a>) out of the box.\nTherefore we decided to build a SKOS shape from the ground up based on the <a href=\"https://www.w3.org/TR/skos-reference/\">SKOS Reference</a>.</p>\n<h2>SKOS Reference Shape</h2>\n<p>The goal was to implement every consistency example from the SKOS Reference as a test case for the shape.\nTo accomplish this it was on the one hand needed to formalize the class and property definitions from the spec as well as the integrity conditions.\nOn the other hand we needed a triple store with reasoning capabilities to apply these rules to the very basic examples in the reference.\nWe used the Apache Jena tooling for this and built a <a href=\"https://github.com/skohub-io/jena-docker\">jena-docker containers</a> based on the docker containers of <a href=\"https://github.com/stain/jena-docker\">this repo</a>.\nThe SKOS class and property definitions are defined in <a href=\"https://github.com/skohub-io/shapes/blob/main/skosClassAndPropertyDefinitions.ttl\">this file</a>.\nThe workflow for validating the SKOS shape is as follows:</p>\n<ol>\n<li>The fuseki container is started with the <a href=\"https://github.com/skohub-io/shapes/blob/main/fuseki/config_inference.ttl\">inference configuration</a>.</li>\n<li>The class and property definitions are appended to <code class=\"language-text\">skos.shacl.ttl</code> file which is mounted in the container.</li>\n<li>The respective example is mounted in the container as a ttl file (e.g. <a href=\"https://github.com/skohub-io/shapes/blob/main/tests/valid/skos.shacl.ttl/ex05.ttl\">example05</a> )</li>\n<li>The validation result (which is itself a RDF graph) is temporarily stored</li>\n<li>The validation result is <a href=\"https://github.com/skohub-io/shapes/blob/main/scripts/checkForViolation.rq\">queried with SPARQL for errors</a></li>\n<li>Based on the query result an error message is put out</li>\n</ol>\n<p>This way we accomplished to validate all valid examples from the SKOS reference up to <a href=\"https://www.w3.org/TR/skos-reference/#example-68\">example 68</a> as valid and all the invalid examples as invalid (entailment vs non-entailment examples were left out).</p>\n<h2>SkoHub Shape</h2>\n<p>In SkoHub Vocabs we are a bit stricter regarding some aspects of the SKOS reference.\nFor example we want every <code class=\"language-text\">skos:Concept</code> to have at least one <code class=\"language-text\">skos:prefLabel</code>.\nTherefore we developed a SkoHub specific shape with <a href=\"https://github.com/skohub-io/shapes/blob/main/skohub.shacl.ttl\"><code class=\"language-text\">skohub.shacl.ttl</code></a>.\nIn contrast to the generic SKOS shape this shape does <strong>not</strong> contain any <a href=\"https://www.w3.org/TR/shacl/#sparql-constraints\">SPARQL based SHACL constraints</a>.\nThough it is possible and especially for more elaborated queries useful to use SPARQL to check constraints, the available tools (at least for javascript <a href=\"https://github.com/zazuko/rdf-validate-shacl\">rdf-validate-shacl</a>) do not support such queries.</p>\n<p>As a result, validation errors and warnings help SkoHub users to improve the quality of their vocabularies. See for example the validation warning for no provided license:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-----------Warning--------------\nMessage:  [\n  Literal {\n    value: 'A provided license increases reusability of a vocabulary. Should be an URI.',\n    language: '',\n    datatype: NamedNode { value: 'http://www.w3.org/2001/XMLSchema#string' }\n  }\n]\nPath:  http://purl.org/dc/terms/license\nNode, where the error occured:  http://w3id.org/example-cs/\nSeverity of error:  http://www.w3.org/ns/shacl#Warning</code></pre></div>\n<p>Or the validation error if the object of <code class=\"language-text\">skos:hasTopConcept</code> is not a <code class=\"language-text\">skos:Concept</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-----------Violation--------------\nMessage:  [\n  Literal {\n    value: 'The target class for hasTopConcept should be skos:Concept',\n    language: '',\n    datatype: NamedNode { value: 'http://www.w3.org/2001/XMLSchema#string' }\n  }\n]\nPath:  http://www.w3.org/2004/02/skos/core#hasTopConcept\nNode, where the error occured:  http://w3id.org/example-cs/\nSeverity of error:  http://www.w3.org/ns/shacl#Violation</code></pre></div>\n<h3>Community</h3>\n<p>Thanks to a lightning talk at SWIB23 (<a href=\"https://pad.gwdg.de/p/0ytHDo597\">slides</a>, <a href=\"https://www.youtube.com/watch?v=jzdU1zHKlNU\">recording</a>) we got some attention to the shape.\nSuggestions made by Jakob Voß, Osma Suominen and Antoine Isaac already greatly improved the shape.\nFurther suggestions and improvements as well as your use cases are highly welcome.</p>\n<h2>Outlook</h2>\n<p>We were quite a bit surprised that we did not find any usable existing SKOS SHACL shape.\nHopefully our work may help others validating their SKOS files and improve the overall quality of vocabularies.\nThere is currently still <a href=\"https://github.com/skohub-io/shapes/issues/9\">an open ticket</a> for implementing the <a href=\"https://github.com/cmader/qSKOS/wiki/Quality-Issues#Ambiguous_Notation_References\">qSKOS best practice rules</a>.\nAny feedback and collaboration on the shapes is welcome!</p>","frontmatter":{"title":"Development of SKOS SHACL shape","date":"November 22, 2023","authors":[{"lastname":"Rörtgen","firstname":"Steffen"}],"description":null}},"previous":{"fields":{"slug":"/2023-02-09-tests-updated/"},"frontmatter":{"title":"Moving to test-driven development and updating existing tests"}},"next":{"fields":{"slug":"/2024-01-18-reconcile/"},"frontmatter":{"title":"Supporting the Reconciliation Service API for SKOS vocabularies"}}},"pageContext":{"id":"e19fa987-ceb2-54a5-b888-63169daac7e7","previousPostId":"a9ca1438-2e05-5355-8e06-72fe48377acc","nextPostId":"bcdcbba9-12cb-50f4-9aa2-de3fc49667db"}},"staticQueryHashes":["1878297489","2734362168","3000541721"],"slicesMap":{}}